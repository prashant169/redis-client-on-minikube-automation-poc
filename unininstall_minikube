#!/bin/bash
set -e

echo "ğŸ§¹ Uninstalling Minikube completely..."

# Step 1: Stop and delete the cluster
echo "ğŸ›‘ Stopping and deleting Minikube cluster..."
minikube stop || echo "âš ï¸ Minikube not running"
minikube delete || echo "âš ï¸ No Minikube cluster to delete"

# Step 2: Delete Minikube binary
MINIKUBE_PATH="/c/Program Files/Minikube/minikube.exe"
if [[ -f "$MINIKUBE_PATH" ]]; then
  echo "ğŸ—‘ï¸ Deleting $MINIKUBE_PATH"
  rm -f "$MINIKUBE_PATH"
else
  echo "âœ… Minikube binary already deleted"
fi

# Step 3: Delete Minikube config and cache
echo "ğŸ—‘ï¸ Removing ~/.minikube and ~/.kube"
rm -rf ~/.minikube ~/.kube

# Step 4: Remove Minikube from system PATH (via PowerShell)
echo "ğŸ§¼ Cleaning Minikube from system PATH..."
powershell.exe -Command "
\$oldPath = [Environment]::GetEnvironmentVariable('Path', 'Machine')
\$newPath = \$oldPath -replace ';C:\\\\Program Files\\\\Minikube', ''
[Environment]::SetEnvironmentVariable('Path', \$newPath, 'Machine')
" || echo "âš ï¸ Could not remove from PATH automatically"

echo "âœ… Minikube successfully uninstalled!"

